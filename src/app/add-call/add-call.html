<div class="form-container">
  <header class="form-header">
    Add Call Record
  </header>

  <form [formGroup]="callForm" (ngSubmit)="onSubmit()">
    @if(!selectedClient){
      <div class="form-field">
        <label for="fullName">Full Name</label>
        <input id="fullName" type="text" formControlName="fullName" autocomplete="off">
        @if (filteredClients().length > 0) {
          <div class="autocomplete-list">
            @for (client of filteredClients(); track client.id) {
              <div class="autocomplete-item" (click)="selectClient(client)">
                <asp-avatar name="{{ client.fullName }}"></asp-avatar>
                {{ client.fullName }}
              </div>
            }
          </div>
        }
      </div>
  
      <div class="form-field">
        <label for="number">Number</label>
        <input id="number" type="tel" formControlName="phoneNumber" autocomplete="off">
      </div>
  
      <div class="form-field">
        <label for="place">Place</label>
        <input id="place" type="text" formControlName="place" autocomplete="off">
        @if (filteredPlaces().length > 0) {
          <div class="autocomplete-list">
            @for (place of filteredPlaces(); track place.id) {
              <div class="autocomplete-item" (click)="selectPlace(place)">{{ place.name }}</div>
            }
          </div>
        }
      </div>
    } @else {
      <div class="client-card" (click)="unselectClient()">
        <asp-avatar name="{{ selectedClient.fullName }}" size="lg"></asp-avatar>
        <div style="flex-grow: 1">
          <div class="flex-stretch">
            <div class="name">
              {{ selectedClient.fullName }}
            </div>
            <div class="place">
              {{ selectedClient.place }}
            </div>
          </div>
          <div class="asp-list-subtext">
            {{ selectedClient.phoneNumber }}
          </div>
        </div>
        <asp-tag>Tap to Edit</asp-tag>
      </div>
    }

    <div class="form-field">
      <label for="callDateTime">Call Date & Time</label>
      <input id="callDateTime" type="datetime-local" formControlName="callDateTime">
    </div>

    <div class="form-field">
      <label for="callDuration">Call Duration (Minutes)</label>
      <input id="callDuration" type="number" formControlName="callDuration">
    </div>

    <div class="form-field">
      <label for="summary">Call Summary</label>
      <textarea id="summary" formControlName="summary" rows="4"></textarea>
    </div>

    <fieldset class="form-field radio-group">
      <legend>Was the call successful?</legend>
      <label class="yes"><input type="radio" [value]="true" formControlName="wasSuccessful"> Yes</label>
      <label class="no"><input type="radio" [value]="false" formControlName="wasSuccessful"> No</label>
    </fieldset>

    @if (callForm.get('wasSuccessful')?.value === false) {
      <div class="form-field">
        <label for="followUpDateTime">Schedule Follow-up</label>
        <input id="followUpDateTime" type="datetime-local" formControlName="followUpDateTime">
      </div>
    }

    <div class="form-actions">
      <button type="submit" [disabled]="callForm.invalid">Save Call</button>
    </div>
  </form>
</div>
